[["notes-atelier-rmarkdown.html", "Memoir Template 1 Notes Atelier Rmarkdown 1.1 Pourquoi utiliser Rmarkdown ? 1.2 Profil des utilisateurs de latelier 1.3 Compilation dans Rstudio 1.4 Écrire un article 1.5 Écrire un mémoire", " Memoir Template CEFE R users 2022-03-25 1 Notes Atelier Rmarkdown Autrices et auteurs : Joris Huguenin Clara Gritti Camila Leandro Nathalie Zeballos Océane Cobelli Ce document est une prise de notes collaboratives de latelier Rmarkdown effectué au CEFE le 25 mars 2022. 1.1 Pourquoi utiliser Rmarkdown ? Utiliser word, notamment pour des documents longs et complexes, peut rapidement être plus couteux en termes deffort. https://bookdown.org/yihui/rmarkdown/ WISYMIG &amp; WISYMIM (sont sur un bâteau ? ) What you see is what you get (word, openoffice) VS What you see is what you mean (Rmarkdown). Sous R, nous pouvons écrire un script qui peut être exporté en .rmd. La fonction knitr (petit bouton sous Rstudio avec une pelotte de laine) permet ensuite de compiler et exporter sous différents formats (.tex (et .pdf), .docx, .html). Pour plus dinformations https://stateofther.github.io/finistR2018/atelier3_advancedrmd.html https://ismayc.github.io/rbasics-book/5-rmdanal.html Avantage dutiliser le package memoiR au lieu de simplement Markdown: Création dun ensemble de fichiers (cf plus bas) pour gérer plus facilement des documents plus longs/complexes (thèse, livre), avec un fichier rmd par chapitre (gain de temps pour knitter, interchanger position des chp etc). 1.2 Profil des utilisateurs de latelier scripts R : 8 TB / 5 BOF [sur 13 partcipants] projets R : 10 oui /3 non [Joris nous parle importance de faire des projets à chaque début de projet, notamment pour lutilisation de Git] Git (Github, GitLab, ) : 4 [le CNRS va déployer un GitLab] BibTex : 10 oui / 3 non [Logiciels type Zotero, // memoiR utilise très bien les documents .bib] Rmarkdown : 8.5 oui / 4.5 non LaTeX : 1 oui / 12 non Beamer : [outil pour construire des présentations ; avantages : facile à faire / désaventages : moins intuitif que powerpoint] MemoiR : personne ne la déjà utilisé 1.3 Compilation dans Rstudio Écrire un fichier .rmd avec un peu de texte, de limport de data, et un résultat sous forme de tableau ou graphe. Déposer les fichiers .rmd ici : https://mycore.core-cloud.net/index.php/s/cdMB0VkkrYplVk3 et les annexes dans les dossiers correspondants. 1.3.1 Le fichier .rmd La cheatsheet : https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf Le guide de référence : https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf 1.3.2 Comment gére-t-on la bibliographie ? citr : package pour faire sa bibliographie (une recherche du nom de lauteur permet dinsérer la réfernce). Pour en savoir plus : https://github.com/crsh/citr Après linstallation du package, il peut être nécessaire de quitter/rouvrir le projet pour que loption Insert citation apparaisse dans le volet de Addins. /! Le package peut ne pas être disponible pour certaines versions de R. On nest pas obligé dinstaller citr si on a précisé le fichier .bib dans le YAML, on peut utiliser @ (fonctionne en mode compas, pas en mode normal). Avec le @, on accède au .bib et à la bibliothèque principale de zotero. Aternative, utiliser les clés de citation bibTex avec les logiciels de gestion de bibliographie : Zotero -&gt; extension Better BibTex [https://retorque.re/zotero-better-bibtex/], crée une clé de citation pour chaque biblio -&gt; extraction dun fichier bibtex lu par R (fichier .bib en UTF-8) -&gt; on le range dans un dossier /biblio dans notre projet R -&gt; pour limporter dans le fichier Rmd on écrit dans len-tête du document (YAML) : bibliography : biblio/nomdufichier.bib ; on peut aussi ajouter des options pour les citations avec biblatexoptions Pour Mendeley il y a cette aide en ligne https://blog.mendeley.com/2011/10/25/howto-use-mendeley-to-create-citations-using-latex-and-bibtex/. Sinon sélectionner les citations qui vous intéressent (CTRL + A sélectionne tout dans le dossier choisi), puis Edit -&gt; Exporter. Le choix du style de citations peut se faire dans les options au début. 1.3.3 YAML ? Partie du haut qui donne les caractéristiques générales du document (titre, auteur, date, gestion de la bibliographie). 1.3.4 chunck ? https://yihui.org/knitr/options/#cache Pour mettre du code dans le document Il est possible dutiliser le raccourci ctrl+alt+i pour insérer rapidement un chunk. 1.3.5 la gestion du cache Dans un premier chunk qui peut sappeler setup on peut ajouter un certain nombre de directives pour lensemble des chunks. Par exemple, comment afficher à chaque fois les images. Pour le cache cest ici quon va introduire deux paramètres, qui permettent que le calcul se fasse quune seule fois et que le résultat soit enregistré, ainsi lors dune prochaine compilation, il ny pas nécessité de tout recalculer (ça fait gagner du temps !). cache = TRUE cache.lazy = FALSE) https://bioinfo-fr.net/maitrisez-cache-de-rmarkdown 1.3.6 Mise en page Visualier le rendu sans knitter : petite icone compas en haut à droite (Switch to visual markdown editor). ** blablabla ** &gt; rendu en gras : blablabla mean(data$colonneA) &gt; sort le résultat de la fonction demandée, ici la moyenne de la colonne A du fichier data 1.3.7 Et les tableaux ? avec kable, kableExtra et flextable kable = le package de base pour afficher des tableaux kableExtra = package amélioré qui permet de mettre en forme les tableaux 1.3.8 Les équations mathématiques ? dans MemoiR : packages amsmaths et amssyms (?), chargés dans le template.tex 1.4 Écrire un article Rmd -&gt; from template [choix parmi un éventail (i.e. PNAS, Plos, Elsevier publications] install.packages(rticles) library(rticles) https://pagedown.rbind.io/ 1.5 Écrire un mémoire Nouveau projet -&gt; Markdown (choisi memoiR -&gt; document type memoir) Beaucoup de fichier et dossiers se créent ; ça peut impressioner, mais ça veut juste dire quil a déjà travaillé. Rien que compiler lexemple permet davoir un guide pour créer son propre mémoire (ça prends plusieurs minutes). Intérêt de faire des chapitres : mieux gérer un doc long (manuscrit de thèse par exemple), inverser ordre des chapitres rapidement (juste changer nom du fichier et R recompile dans le nouvel ordre), temps de compilation qui diminue. chapitrer son document Le référencement croisé https://ericmarcon.github.io/memoiR/gallery/memoir/bookdown_gitbook/index.html https://ericmarcon.github.io/travailleR/ [Excellente référence pour travailler sur R (pas que sur Markdown)] Plusieurs fichiers créés, dont : index &gt; YAML que dans ce fichier (préciser page de garde créée en tant que pdf au préalable) précision de la langue (pour accès aux accents etc), de labstract, des mots-clés dans ce fichier ; Il est en effet important de noter -langage: english (ou bien le langage utilisé dans le document) 1er chunk : NE PAS MODIFIER ! 2ème chunk qui permet de gérer le style des figures 3ème chunk : knitr options &gt; mettre la librairie ici Glossaire : permet de faire le lien avec les titres de nos différents chapitres -unnumbered (ne pas commencer la pagination à cette section) syntax getting start etc. Organisation de notre mémoire : le + efficace cest de faire 1 fichier par chapitre, la numérotation des chapitres va permettre de compiler le tout dans le bon ordre (mais après, ça reste une préférence personnelle, on peut mettre tous les chapitres dans le même fichier si on préfére, ça sera un peu + long à compiler) Références internes au document à mettre entre {} Dans le sous-dossier latex template.tex -&gt; package intégrés pour écrire des formules mathématiques, options pour la bibliographie, options gitbook avec titre et url personnels (researchgate) Indiquer la langue quon utilise (dans template.tex) : sert à charger les bons caractères (notamment pour les accents) et possibilité davoir un correcteur orthographique Template.tex = tout est déjà réglé en language LaTex, bien pratique si on veut juste modifier qqs options Fichiers after_body.tex = pour ajouter des annexes en fin de rapport Package tinytex : gère le langage LaTex dans R "],["les-pinèdes.html", "2 Les pinèdes 2.1 de nos régions", " 2 Les pinèdes 2.1 de nos régions Cest trop joli. Il y a plein de pins. une image de pinède de pins dAlep Note de Joris : Attention, jai corrigé ladresse de limage. Puisque nous travaillons dans un projet, il faut juste écrire images/pinede.jpg et non pas C:/Users/c.gritti/Documents/CEFE_book/ "],["e-partie-les-pollinisateurs-des-pins.html", "3 2e partie : les pollinisateurs des pins 3.1 ça nexiste pas", " 3 2e partie : les pollinisateurs des pins 3.1 ça nexiste pas Par contre il y en a en dessous pour le romarin et le thym. kable(export_TAG_3011_net[1:10, c(24, 73, 83)], align = &quot;c&quot;) %&gt;% kable_styling(latex_options = &quot;striped&quot;) commune nom_reconnu abondance Gruissan Smilax aspera L., 1753 P Gruissan Quercus ilex L., 1753 1 Gruissan Smilax aspera L., 1753 P Gruissan Aphyllanthes monspeliensis L., 1753 1 Gruissan Quercus ilex L., 1753 P Gruissan Aphyllanthes monspeliensis L., 1753 P Leucate Quercus ilex L., 1753 P Leucate Sedum sediforme (Jacq.) Pau, 1909 P Leucate Smilax aspera L., 1753 P Leucate Helichrysum stoechas (L.) Moench, 1794 P library(sp) library(raster) library(rgdal) # install.packages(&#39;Rtools&#39;) install.packages(&#39;citr&#39;) # install.packages(&#39;devtools&#39;) library(devtools) # devtools::install_github(&#39;crsh/citr&#39;) library(citr) "],["aperçu-des-données.html", "4 Aperçu des données", " 4 Aperçu des données Nous avons un raster daltitude à 25m pour la région des Alpes du Sud, téléchargé depuis le site de lIGN (IGN 2013). # data = read_excel(&#39;data/releves_genepi_2021.xlsx&#39;, sheet # = 2) raster = raster(&quot;data/MNT25_PNM.tif&quot;) # limites = readOGR(&#39;data/pn2008.shp&#39;) crs(limites) = # CRS(&#39;EPSG:2154&#39;) Ce raster peut être visualisé ci-dessous. References "],["présentation-de-la-ptr-tof-ms.html", "5 Présentation de la PTR-ToF-MS 5.1 Une brève histoire de la PTR-ToF-MS 5.2 Instrumentation générale 5.3 Analyse et conclusion 5.4 Résultats de la MCR 5.5 Bibliographie", " 5 Présentation de la PTR-ToF-MS De très nombreux projets de recherche issus du CeMEB nécessitent lanalyse de Composés Organiques Volatils (COV ou VOC en anglais) aussi communément appelés odeurs. Les COVs sont omniprésents dans la nature et permettent, avec les autres sens, une organisation du vivant en agissant comme vecteur dinformation de la médiation chimique. Par lacquisition dun PTR-ToF-MS, la communauté souhaitait lever trois verrous techniques : lappareil permet un fonctionnement en flux continu avec une résolution temporelle très fine (fréquence danalyse allant jusquà 10 scans par seconde), permettant ainsi le suivi des cinétiques démissions de COV. Cet instrument simplifie drastiquement et affine les expériences cinétiques effectuées par des mesures moyennées de GC-MS; le PTR-ToF-MS possède une excellente résolution en masse qui facilite lidentification des molécules. Un spectre est composé de plus de 140 000 mesures de masses couvrant une large gamme des masses des COV biologiques (de 70 à 500 m/z). Lappareil possède donc une résolution environ mille fois supérieure par rapport à un simple quadripôle (PTR-MS ou GC-MS) qui fournit des m/z à lunité de masse atomique (uma ou Dalton Da); le seuil de détection extrêmement bas, de lordre du ppt (part per trillion), permet une sensibilité adaptée à la mesure de traces. 5.1 Une brève histoire de la PTR-ToF-MS Durant la décennie 1990, lInstitut für Ionenphysik der Leopold-Franzens-Universität dInnsbruck en Autriche développe un nouvel instrument pour lanalyse chimique des gaz. En travaillant avec la Universitiitsklinik fiir Innere Medizin, léquipe menée par Lindinger développe un spectromètre en phase gazeuse qui ionise les molécules grâce à un gaz neutre ((W. Lindinger, Leiter, and Andriollo 1991) et (W. Lindinger, Hirber, and Paretzke 1993)). Ils comprennent rapidement lavantage dutiliser un proton (apporté à la réaction sous la forme H3O+) par rapport aux ions Kr+ et Xe+. Ils publient une sorte de preuve de concept en 1994 (Lagg et al. 1994) et détaillent plus finement linstrumentation et les réactions chimiques (Hansel et al. 1995)1. En 1998 sort larticle qui fait désormais référence, (W. Lindinger, Hansel, and Jordan 1998), signé par le trio Lindinger, Hansel et Jordan (et sa version courte W. Lindinger and Jordan (1998)). Ionicon commercialise la même année le premier PTR-MS. Cette technique se déploie rapidement dans les sciences de latmosphère, médicales et biotech ((Babcock and Adams 2001)) permettant la détection de traces de COV. Rapide et sensible, la PTR-MS élimine certains désavantages de la GC-MS. Cependant, la PTR-MS détecte de la masse nominale des ions. Un échantillon complexe peut contenir plusieurs ions isobares2. Il convient alors de gagner en résolution de masse et séparer ces isobares. (Jordan et al. 2009) revient sur les tentatives les plus concluantes ((Blake et al. 2004), (Ennis et al. 2005), (Inomata et al. 2006) et (Tanimoto et al. 2007) ) avant de proposer son approche : la PTR-ToF-MS. Développé en collaboration avec la précédente équipe, le minutieux article de (Graus, Müller, and Hansel 2010) conclu superbement la vingtaine dannées de développement nécessaire à cette technique. Les années suivantes permettront simplement une amélioration des différentes parties de linstrument. Par ailleurs, cest au tour des mathématiciens dapporter leur contribution et en particulier à léquipe de Cappellin avec deux articles. Le premier, (Cappellin et al. 2010), permet de mieux estimer la masse exacte de chaque ion détecté. Le seconde, (Cappellin et al. 2011), offre une méthodologie détaillée de lutilisation du PTR-ToF-MS de lacquisition à la fin de lanalyse. Puis en 2015, (Holzinger 2015) propose un logiciel pour lanalyse des data mais cette tentative na pas été suivie par la communauté dutilisateurs. Il existe désormais un nombre important darticles utilisant la PTR-ToF-MS. Bien entendu, des outils communs de chimiométrie ont été utilisés pour renforcer les résultats, (Deuscher et al. 2019). Mais cela sera abordé dans le chapitre suivant. Je suppose que la prochaine avancée majeure viendra dune technologie permettant de discriminer les isomères3 (Claflin et al. 2021).4 Par exemple, cela permettrait de séparer les différents monoterpènes omniprésents dans les émissions végétales et qui nous concernent particulièrement en écologie chimique. Actuellement, ce désavantage est comblé par le couplage de la PTR-ToF-MS avec une seconde technique danalyse chimique. Ce court historique montre toutefois que la collaboration entre physiciens, chimistes, biologistes et mathématiciens est fructueuse et promise à un bel avenir. 5.2 Instrumentation générale Schéma de la chambre dionisation (Reprinted with permission from Krechmer et al. (2018). Copyright 2021 American Chemical Society.) Comme nous lavons vu précédemment, le PTR-ToF-MS est conçu pour analyser finement la masse moléculaire des échantillons. Pour cela linstrument aspire un débit dair constant de 100 ml/min5. Cet air in sur la figure ?? peut être connecté à un gaz zéro pour diluer un échantillon trop concentré (pour éviter la saturation) ou à un gaz étalon pour létalonnage de linstrument. Le flux dair est ensuite injecté dans le réacteur (FIMR pour focusing ion-molecule reactor). Dans cette chambre, des ions H+ issus deau ultra pure sont également injectés à débit constant afin dioniser les molécules de léchantillon (Proton-Transfer-Reaction). Il est important de comprendre que, contrairement à une ionisation par électron6, il ny a quasiment pas de fragmentation moléculaire. Cest une ionisation douce, comme en ESI (ElectroSpray Ionization) fréquemment utilisée en LC-MS. Les ions ont une unité de masse molaire de plus(un proton) que les ions moléculaires. Par exemple, le linalol, un COV fortement produit par la lavande, a une masse molaire de 154,249 g/mol mais sera detecté à 155,256 g/mol. Par ailleurs, le nombre dions MH+ détectés dépend du taux de protonation de la molécule M. Sous forme dions, léchantillon peut être focalisé par un champ électromagnétique généré par un quadripôle et envoyé dans la partie ToF. Une fois dans la colonne, lénergie potentielle dun pulse électromagnétique à 25kHz est convertie en énergie cinétique par les ions propulsés. À énergie constante, la masse fait la différence lors de la mesure du temps de vol (ToF, figure ??). Ainsi les ions les moins lourds arrivent en premiers sur le détecteur. Le comptage du nombre de coups sur le détecteur donne lintensité par unité de temps. Un étalonnage, avec des ions moléculaires étalons, permet de convertir le temps de vol en masse, ce qui permet par la suite danalyser les masses des échantillons inconnus. Schéma de la colonne ToF et du détecteur MS (Reproduit de larticle Graus, Müller, and Hansel (2010)) Pour une compréhension plus exhaustive, je recommande la lecture des articles de Hansel et al. (1995) pour la partie PTR-MS, de Graus, Müller, and Hansel (2010) pour la partie ToF et de Krechmer et al. (2018) spécifique à linstrument utilisé au CEFE. 5.3 Analyse et conclusion 5.3.1 Le plan dexpérience Pour illustrer cela, je présenterais une expérience sur les lavandes. Cette expérience sinscrit dans un cadre dun projet MUSE (Montpellier Université dExcellence) porté par Magali Proffit et sintéressant aux phénomènes de pollution à lOzone O_3 liés au changement climatique global. Nous nous sommes intéressés aux variations journalières des émissions de COV de lavandes isolés dans des chambres de prélèvements. Les acquisitions se déroulaient durant 48h à cheval sur trois jours et deux nuits afin de décrire le rythme circadien des plantes. Nous avons mis en place quatre chambres de mesure permettant chacune soit disoler un plant de lavande soit dêtre un blanc. Ces chambres de mesure sont des cylindres en plastique, ventilés, de volumes équivalents et reliés à un flux dair zéro dun débit de 5 litres/min. La longueur et le volume des lignes reliant les chambres à linstrument de mesure nétaient pas identiques. Nous avons lancé des acquisitions sur les quatre chambres séquentiellement durant 48h. Nous avons répété ce processus deux fois, pour obtenir neuf plants au total dans notre plan dexpérience (cf. ??). 5.4 Résultats de la MCR Figure 5.1: Spectres purs, loadings MCR Figure 5.2: Evolution cinetique des spectres purs Les spectres issus de ces expériences sont ensuite analysés avec des outils de chimiométrie pour explorer au maximum toute la complexité des données à traiter. Certains algorithmes, comme la MCR-ALS, permettent le développement de modèles multivoies pour prendre en compte laspect cinétique de la PTR-ToF-MS. Jai utilisé lalgorithme de la MCR-ALS pour décomposer le spectre total en spectres purs( 5.2 ). Ces spectres purs sont des ensembles de COV représentatifs dun phénomène propre. En optimisant la MCR-ALS, jai fait ressortir, entre autres, lévolution de deux spectres purs montrant un double cycle démission journalier ( 5.2 ). La première activité intervient peu après laube, atteint un pic démission autour de 8h et diminue rapidement pour retrouver un niveau comparable au niveau initial vers midi. La seconde activité plus tardive augmente jusquà un plateau atteint vers midi et se prolonge jusquà 16h pour décroître par la suite. 5.5 Bibliographie This template is based on Bookdown and the Memoir LaTeX class to allow writing a book, a report, a PhD thesis, etc. in R Markdown. The main file is index.Rmd which contains the description of the book in its header. All other .Rmd files in the folder contain a chapter. The references.bib file contains the bibliography. This file will have to be deleted, as well as 81-getting_started.Rmd and 82-syntax.Rmd: they have to be replaced by the content of the book. To get started, create a new R project from this folder. Then open index.Rmd and click on the Build Book button in the Build window of Rstudio. "]]
